<script>

  

  $(document).ready(function(){
    
    $('[id^=clientSelect]').selectpicker('val','');
    $('[id^=clientSelect]').selectpicker('refresh');

    $('[id^=refreshGmail]').find('.spinner').addClass('spinner-busy');
    $('[id^=refreshGmail]').find('.spinner+span').hide();

    $('.selectpicker').selectpicker('refresh');

    $('[id^=dateSelect]').daterangepicker({
        "singleDatePicker": true,
        "startDate": endDate,
        "maxDate": endDate,
        "locale": {
            "format": "M/D/YYYY"
        }
    });

    // // 초기 계산 방법 Requested N 으로 선택 | Set initial calculation method to Requested N
    // $('input[name^="Calculation method"][value="Requested N"]').prop('checked', true);

    // // RFQ 로딩 정보 숨김 | Hide loaded RFQ information
    // $('.loaded-info').hide();

    // // 기본으로 '운영비 항목' checkbox를 숨김 | Hide 'Other fee options' checkbox by default
    // $('[id^=otherFeeBox]').hide();

    // $('[id^=sopUseBoxInput]').children().hide();

    // // 기본으로 '파트너이용' 부분을 숨김 | Hide '3rd party Usage' section by default
    // $('[id^=partnerUseBox]').children().hide();


    // QQ 창을 닫거나 새로고침 할 때 경고 메시지 표시 | Display a warning message when closing or refreshing the QQ page
    window.addEventListener('beforeunload', function(e) {
        e.preventDefault();
        e.returnValue = '';
    });

    

    // 모달창 표시 시 스타일 조정 - 여러개의 모달창이 열렸을 때 쌓이도록 설정 | Adjust styles when modal is shown - stacks modals on top when multiple modals are open
    $(document).on('show.bs.modal', '.modal', function(event) {
        // 모달의 z-index 계산 | Calculate the z-index for the modal
        var zIndex = 1060+ (10 * $('.modal:visible').length);
        // 현재 모달에 계산된 z-index 설정 | Set the calculated z-index for the current modal
        $(this).css('z-index', zIndex);

        // 모달창이 완전히 표시된 후 코드를 실행할 수 있도록 setTimeout 설정 | Renders the following code after the modal is fully shown by using setTimeout
        setTimeout(function() {
            // 새로운 모달이 열렸을 때 z-index가 이전에 열려있던 모달보다 높을 수 있도록 설정 | Ensures that each new modal gets a higher z-index than the previous ones
            $('.modal-backdrop').not('.modal-stack').css('z-index', zIndex - 1).addClass('modal-stack');
        }, 200);

    });

    // 클라이언트 드롭다운에서 'Other' 선택 시 모달창 표시 | Show modal when 'Other' is selected for client
    $(document).on('change', '[id^=clientSelect]', function(){
        clientSelectEl = $(this).attr('id');
        $modal = $('#addClientModal');
        if($(this).val() === 'Other'){
            $modal.modal('show');
        }
    });

    // 운영비 항목 안내 링크 클릭 시 모달창 표시 | Show modal when 'Other Fee Guide' link is clicked
    $(document).on('click', '.other-fee-guide', function(e){
        e.preventDefault();
        $modal = $('#addOtherFeeModal');
        $modal.modal('show');
    });

    // input 또는 select 엘리먼트에 입력 또는 변경 이벤트가 발생할 때 | When an input or select element has an input or change event
    $(document).on('input change', '#quoteForm input, #quoteForm select', function(){
        // 폼의 유효성 여부를 확인하기 위한 변수 초기화 | Initialize variable to check the validity of the form
        var formValid = true;

        // 필수 속성이 설정된 가시(input 또는 select) 엘리먼트를 필터링하고 각각에 대해 확인 | Filter visible (input or select) elements with required attribute and check each one
        $('#quoteForm input, #quoteForm select').filter('[required]:visible').each(function() {
            // 값이 비어있는 경우 폼 유효성을 false로 설정 | Set form validity to false if the value is empty
            if ($(this).val() === '') {
                formValid = false;
            }
        });

        // 폼이 유효한 경우 저장 버튼에 플래시 클래스 추가 | If the form is valid, add a flash class to the save button
        if (formValid) {
            //$('#saveAll').addClass("flash-save-btn");
            if(rfqModeOS !== 'OS') {
                $('#saveAll').closest('.save-btn-group').addClass("flash-save-btn");
            } else {
                $('#save-exportAll').closest('.save-btn-group').addClass("flash-save-btn");
            }
            //if(isLoaded) { $('#updateAll').addClass("flash-update-btn"); }
        } else {
            // 폼이 유효하지 않은 경우 저장 버튼에서 플래시 클래스 제거 | If the form is not valid, remove the flash class from the save button
            //$('#saveAll').removeClass("flash-save-btn");
            if(rfqModeOS !== 'OS') {
                $('#saveAll').closest('.save-btn-group').removeClass("flash-save-btn");
            } else {
                $('#save-exportAll').closest('.save-btn-group').removeClass("flash-save-btn");
            }
            //if(isLoaded) { $('#updateAll').removeClass("flash-update-btn"); }
        }
    });

    // dropdown에서 같은 value 선택하면 unselect 하기
    $(document).on('click', '.selectpicker+button', function(){
      //var prev_val = $(this).parent().find('select').val();

      $(this).closest('div.bootstrap-select').find('ul.dropdown-menu li').off('click').on('click', function(){
        //console.log(true);
        //console.log($(this).attr('class'));
        if($(this).hasClass('selected')){
          $(this).closest('div.bootstrap-select').find('select').selectpicker('val','');
          $(this).closest('div.bootstrap-select').find('select').selectpicker('refresh');
        }
      });

      if($(this).closest('div.bootstrap-select').find('select').attr('id') == 'trapQuestion') {
        previousT = $(this).closest('div.bootstrap-select').find('select option:selected').index();

        $(this).closest('div.bootstrap-select').find('ul.dropdown-menu li').off('click').on('click', function(){
      //}).change(function() {
        
          //"CPI" 입력란 보더에 FlashBorder 함수 적용 | Apply the FlashBorder function to the "CPI" input border
          FlashBorder('#cpiValue');
          
          //var currentT = this.selectedIndex;
          var currentT = $(this).index() + 1;

          if($(this).hasClass('selected')){
            currentT = 1;
            $(this).closest('div.bootstrap-select').find('select').selectpicker('val','');
            $(this).closest('div.bootstrap-select').find('select').selectpicker('refresh');
          }

          //console.log(previousT);
          //console.log(currentT);

          // "CPI"의 현재 값 가져오기 및 정수로 변환 | Get the current value of "CPI" and convert it to an integer
          var cpiValue = parseInt($('#cpiValue').val().replace(/,/g , ''), 10);

          // "특수패널"의 선택된 옵션 인덱스가 2 또는 3인 경우 | If the selected option index of "Specific age grp" is 2 or 3
          if ($('#specialPanel').find(':selected').index() == 2 || $('#specialPanel').find(':selected').index() == 3) {
            // CPI에서 1000을 빼기 | Subtract 1000 from CPI
            cpiValue = cpiValue - 1000;

            // CPI 값이 숫자이고 선택이 2 또는 3인 경우 | If CPI value is a number and selection is 2 or 3
            if ((!isNaN(cpiValue)) && (currentT == 2 || currentT == 3)) {
                // 선택이 2이고 (이전 선택이 2 또는 3이 아닌 경우) | If selection is 2 and (previous selection is not 2 or 3)
                if (currentT == 2 && (previousT !== 2 && previousT !== 3)) {
                    // 1.1을 곱하고 1000을 더한 값을 반올림하여 CPI에 입력 | Multiply by 1.1, add 1000, and assign the rounded value to CPI
                    $('#cpiValue').val(AddComma(Math.round((cpiValue + Number.EPSILON) * 1.1 + 1000)));
                }
                // 선택이 3이고 (이전 선택이 2 또는 3이 아닌 경우) | If selection is 3 and (previous selection is not 2 or 3)
                if (currentT == 3 && (previousT !== 2 && previousT !== 3)) {
                    $('#cpiValue').val(AddComma(Math.round((cpiValue + Number.EPSILON) * 1.2 + 1000)));
                }
                // 선택이 2이고 이전 선택이 3인 경우 | If selection is 2 and previous selection is 3
                if (currentT == 2 && previousT == 3) {
                    $('#cpiValue').val(AddComma(Math.round((cpiValue + Number.EPSILON) / (1.2 / 1.1) + 1000)));
                }
                // 선택이 3이고 이전 선택이 2인 경우 | If selection is 3 and previous selection is 2
                if (currentT == 3 && previousT == 2) {
                    $('#cpiValue').val(AddComma(Math.round((cpiValue + Number.EPSILON) * (1.2 / 1.1) + 1000)));
                }
            }

            // CPI 값이 숫자이고 선택이 1이며, 이전 선택이 정의되어 있는 경우 | If CPI value is a number, selection is 1, and previous selection is defined
            if (!isNaN(cpiValue) && currentT == 1 && previousT !== undefined) {
                // 이전 선택이 2인 경우 | If previous selection is 2
                if (previousT == 2) {
                    $('#cpiValue').val(AddComma(Math.round((cpiValue + Number.EPSILON) / 1.1 + 1000)));
                }
                // 이전 선택이 3인 경우 | If previous selection is 3
                if (previousT == 3) {
                    $('#cpiValue').val(AddComma(Math.round((cpiValue + Number.EPSILON) / 1.2 + 1000)));
                }
            }
          }  
          if ($('#specialPanel').find(':selected').index() == 0 || $('#specialPanel').find(':selected').index() == 1) {
                // CPI 값이 숫자이고 선택이 2 또는 3인 경우 | If CPI value is a number and selection is 2 or 3
                if ((!isNaN(cpiValue)) && (currentT == 2 || currentT == 3)) {
                    // 선택이 2이고 (이전 선택이 2 또는 3이 아닌 경우) | If selection is 2 and (previous selection is not 2 or 3)
                    if (currentT == 2 && (previousT !== 2 && previousT !== 3)) {
                        // 1.1을 곱하고 반올림하여 cpiValue에 할당 | Multiply by 1.1 and assign the rounded value to cpiValue
                        $('#cpiValue').val(AddComma(Math.round((cpiValue + Number.EPSILON) * 1.1)));
                    }
                    // 선택이 3이고 (이전 선택이 2 또는 3이 아닌 경우) | If selection is 3 and (previous selection is not 2 or 3)
                    if (currentT == 3 && (previousT !== 2 && previousT !== 3)) {
                        $('#cpiValue').val(AddComma(Math.round((cpiValue + Number.EPSILON) * 1.2)));
                    }
                    // 선택이 2이고 이전 선택이 3인 경우 | If selection is 2 and previous selection is 3
                    if (currentT == 2 && previousT == 3) {
                        $('#cpiValue').val(AddComma(Math.round((cpiValue + Number.EPSILON) / (1.2 / 1.1))));
                    }
                    // 선택이 3이고 이전 선택이 2인 경우 | If selection is 3 and previous selection is 2
                    if (currentT == 3 && previousT == 2) {
                        $('#cpiValue').val(AddComma(Math.round((cpiValue + Number.EPSILON) * (1.2 / 1.1))));
                    }
                }
                // CPI 값이 숫자이고 선택이 1이며, 이전 선택이 정의되어 있는 경우 | If CPI value is a number, selection is 1, and previous selection is defined
                if (!isNaN(cpiValue) && currentT == 1 && previousT !== undefined) {
                    // 이전 선택이 2인 경우 | If previous selection is 2
                    if (previousT == 2) {
                        $('#cpiValue').val(AddComma(Math.round((cpiValue + Number.EPSILON) / 1.1)));
                    }
                    // 이전 선택이 3인 경우 | If previous selection is 3
                    if (previousT == 3) {
                        $('#cpiValue').val(AddComma(Math.round((cpiValue + Number.EPSILON) / 1.2)));
                    }
                }
          }
          // 이전 선택 인덱스에 현재 선택 인덱스 할당 | Assign the current selection index to the previous selection index
          //previousT = this.selectedIndex;
          previousT = currentT;
        });
      }

      if($(this).closest('div.bootstrap-select').find('select').attr('id') == 'specialPanel') {
        previousS = $(this).closest('div.bootstrap-select').find('select option:selected').index();

        $(this).closest('div.bootstrap-select').find('ul.dropdown-menu li').off('click').on('click', function(){
            // 테두리 플래시 및 CPI 값 가져오기 | Flash border and get the CPI value
            FlashBorder('#cpiValue');

            var currentS = $(this).index() + 1;

            if($(this).hasClass('selected')){
              currentS = 1;
              $(this).closest('div.bootstrap-select').find('select').selectpicker('val','');
              $(this).closest('div.bootstrap-select').find('select').selectpicker('refresh');
            }

            var cpiValue = parseInt($('#cpiValue').val().replace(/,/g , ''), 10);

            // CPI 값이 숫자이고 선택이 2 또는 3이며, 이전 선택이 2 또는 3이 아닌 경우에 1000을 더함 | Add 1000 if CPI value is a number, selection is 2 or 3, and the previous selection is not 2 or 3
            if (!isNaN(cpiValue) && (currentS == 2 || currentS == 3) && (previousS !== 2 && previousS !== 3)){
                $('#cpiValue').val(AddComma(cpiValue + 1000));
            }

            // CPI 값이 숫자이고 선택이 1이며, 이전 선택이 정의되어 있는 경우에 1000을 뺌 | Subtract 1000 if CPI value is a number, selection is 1, and the previous selection is defined
            if (!isNaN(cpiValue) && currentS == 1 && previousS !== undefined){
                $('#cpiValue').val(AddComma(cpiValue - 1000));
            }

            // 이전 선택 값을 갱신 | Update the previous selection value
            previousS = currentS;
        });
      }
    });

    // Quotaion form을 초기화 | Reset Quotation form
    $(document).on('click', '#clearForm', function(e){
        e.preventDefault();
        // 폼 리셋 및 초기화 | Reset and initialize the form
        $('#quoteForm')[0].reset();
        $('#quoteForm input[type=hidden]').val('');
        $('.selectpicker').selectpicker('refresh');
        $('#partnerUseBoxCnt').parent().hide();
        $('#partnerUseBox').children().hide();
        $('#otherFeeBox').hide();
        $('#sopUseBox').hide();
        $('#sopUseBoxInput').children().hide();
        $('input[name="Calculation method"][value="Requested N"]').prop('checked', true);
        $('#countrySelect').find('option[value="KR"]').prop('selected', true);
        $('.showActualCPI').text('');
        $('.showSOP_1CPI').text('');
        $('.showSOP_2CPI').text('');
        $('.loaded-info').hide();
        isLoaded = false;
        $('.rfq-status').hide();
        $('#updateAll').addClass('btn-disabled');
        if(rfqModeOS !== 'OS') {
            $('#saveAll').closest('.save-btn-group').removeClass("flash-save-btn");
        } else {
            $('#save-exportAll').closest('.save-btn-group').removeClass("flash-save-btn");
        }
        $('#updateAll').removeClass("flash-update-btn");
        $('.selectpicker').selectpicker('refresh');
        endDate = moment();
        $('#dateSelect').daterangepicker({
            "singleDatePicker": true,
            "startDate": endDate,
            "maxDate": endDate,
            "locale": {
              "format": "M/D/YYYY"
            }
        });
        $('#quoteForm').removeClass('was-validated');
        // $('#managerSelect').find('option[data-tokens="'+ managerName +'"]').prop('selected',true);
        // $('#managerSelect').selectpicker('refresh');
        $('#managerSelect'+rfqModeOS).val(managerName).change().selectpicker('refresh');
        $('#partnerUseBox').removeClass('partnerusebox-bottom-margin');
    });

    // Calculated quotation을 초기화 | Reset Calculated quotation
    $(document).on('click', '#clearCalc', function(e){
      e.preventDefault();
      $('#calcResultTable tbody').children().remove();
      calcCnt = 1;
    });
    
    // Quote table을 초기화 | Reset Quote table
    $(document).on('click', '#clearTable', function(e){
      e.preventDefault();
      $('.tg-i81m,.tg-cwv5,.tg-bj79,.tg-qxa8').find('span').text('');
    });

    // 클라이언트 드롭다운에서 'Other' 선택한 경우 | If 'Other' is selected in the client dropdown.
    $(document).on('click', '#saveOtherClient', function(e){
        e.preventDefault();

        // 클라이언트 이름과 그룹이 비어있는 경우 경고 메시지 표시 | Show a warning message if client name and group are empty
        if ($('#clientName').val() == "" || $('#clientGroup').val() == "") {
            // 언어가 한국어이거나 비어있는 경우 | If the language is Korean or empty
            if (lang == "ko" || lang == "") {
                $('#alertMessage').text('클라이언트 정보를 입력해주세요.');
            }
            // 언어가 영어인 경우 | If the language is English
            if (lang == "en") {
                $('#alertMessage').text('Please enter client info.');
            }

            // 경고 모달 표시 | Show the warning modal
            $modal = $('#warningAlert');
            $modal.modal('show');
        }

        // 클라이언트 이름과 그룹이 비어있지 않은 경우 | If client name and group are not empty
        if ($('#clientName').val() !== "" && $('#clientGroup').val() !== "") {
            // 클라이언트 인덱스 가져오기 | Get the client index
            var cliIdx = $('#'+clientSelectEl).children().eq($('#clientGroup option:selected').index());

            // 새로운 옵션을 추가 | Append a new option
            cliIdx.append('<option value="'+$('#clientName').val()+'">'+$('#clientName').val()+'</option>');

            // 기존 선택을 해제하고 새로 추가된 옵션을 선택 | Deselect the existing selection and select the newly added option
            $('#'+clientSelectEl).find(":selected").prop('selected', false);
            cliIdx.children().eq(cliIdx.children().length - 1).prop('selected', true);

            // 클라이언트 선택 텍스트 업데이트 | Update the text for the selected client
            $('#'+clientSelectEl).next().children().find('.filter-option-inner-inner').text($('#'+clientSelectEl).find(":selected").val());

            // 입력 필드 초기화 | Reset the input fields
            $('#clientName').val('');
            $('#clientGroup').val('');
            $('#clientGroup').selectpicker('refresh');

            // 선택된 그룹 업데이트 | Update the selected group
            $('#selectedGroup').val($('#'+clientSelectEl).find(':selected').parent().attr('label'));

            // 클라이언트 추가 모달 닫기 | Close the add client modal
            $('#addClientModal').modal('hide');
        }

        // 클라이언트 선택 피커 갱신 | Refresh the client select picker
        $('#'+clientSelectEl).selectpicker('refresh');
    });


    // Load RFQ Data 모달에서 [Load RFQ] 버튼 클릭 시 Quotation form에 선택한 RFQ 데이터가 모두 로드 됨 | When the [Load RFQ] button is clicked in the "Load RFQ Data" modal, the selected RFQ data is loaded into the Quotation form.
    $(document).on('click', '#loadRFQData', function(e){
        e.preventDefault();

        // 선택된 RFQ 데이터가 없으면 경고 메시지 표시 | Show a warning message if no RFQ data is selected
        if ($('#selectRFQList option:selected').val() === '') {
            // 언어가 한국어이거나 비어있는 경우 | If the language is Korean or empty
            if (lang == "ko" || lang == "") {
                $('#alertMessage').text('RFQ 리스트에서 데이터를 선택해주세요.');
            }
            // 언어가 영어인 경우 | If the language is English
            if (lang == "en") {
                $('#alertMessage').text('Please select a data from RFQ List dropdown.');
            }

            // 경고 모달 표시 | Show the warning modal
            $modal = $('#warningAlert');
            $modal.modal('show');
            return false;
        }

        // Actual CPI 초기화 | Initialize Actual CPI
        var actualCPI = 0;

        // var sop_1CPI = 0;

        // var sop_2CPI = 0;

        // 선택한 RFQ 데이터의 정보(ID,클라이언트,프로젝트명 등) 가져오기 | Get the info(ID,client,project name, etc) of the selected RFQ
        var loadedRFQName = $('#selectRFQList option:selected').attr('title');

        // RFQ 로딩 정보 표시 | Show loaded RFQ information
        $('.loaded-info').show();

        // 체크박스 선택 해제 | Uncheck all checkboxes
        $('.checkbox-option').each(function(index){
            $(this).prop('checked', false);
        });

        $('.sop-checkbox-option').prop('checked',false);

        // Calculation method 초기화 | Initialize Calculation method
        $('input[name="Calculation method"][value="Requested N"]').prop('checked', false);
        $('input[name="Calculation method"][value="dS Feasible N"]').prop('checked', false);

        $('#updateStatusSwitch').prop('checked', true);
        $('.rfq-status').show();

        // fillInputArray 배열(Load RFQ Data 모달에서 선택한 RFQ 데이터)에서 각 항목을 가져와서 폼에 입력 | Retrieve each item from the fillInputArray (RFQ data selected from the Load RFQ Data modal) and input it into the form
        fillInputArray.forEach(function (pair) {
            var selector = `input[name="${ pair.name }"], select[name="${ pair.name }"], textarea[name="${ pair.name }"]`;
            var input = $('#quoteForm').find(selector).not('input[type="radio"]');
            input.val(pair.value);

            // Actual CPI 값 저장 | Save Actual CPI value
            if (pair.name == "Actual CPI") {
                actualCPI = pair.value;
            }

            // if (pair.name == "SOP_1 CPI") {
            //     sop_1CPI = pair.value;
            // }

            // if (pair.name == "SOP_2 CPI") {
            //     sop_2CPI = pair.value;
            // }

            // 운영비 항목이면 값 처리 | If it's the Other fee options item, handle the value
            if (pair.name == "Other fee options") {
                if (pair.value !== '') {
                    $('#otherFeeSwitch').prop('checked', true);
                    $('#otherFeeBox').show();

                    // 콤마로 구분된 값들을 처리하여 해당하는 운영비 항목 체크박스 선택 | Process comma-separated values to select the corresponding other fees items checkboxes.
                    pair.value.split(',').forEach(function(item){
                        $('.checkbox-option').each(function(index){
                            if ($(this).val() == item) {
                                $(this).prop('checked', true);
                            }
                        });
                    });
                } else {
                    $('#otherFeeSwitch').prop('checked', false);
                    $('#otherFeeBox').hide();
                }
            }

            if (pair.name == "SOP_1 Costs") {
              if (pair.value !== '') {
                $('#sopSOP_1').prop('checked',true);
                //$('#sopUseBoxInput').children().eq(0).show();
                $('#sop_1UseBoxInput').show();
              } else {
                $('#sopSOP_1').prop('checked',false);
                //$('#sopUseBoxInput').children().eq(0).hide();
                $('#sop_1UseBoxInput').hide();
              }
            }

            if (pair.name == "SOP_2 Costs") {
              if (pair.value !== '') {
                $('#sopSOP_2').prop('checked',true);
                //$('#sopUseBoxInput').children().eq(0).show();
                $('#sop_2UseBoxInput').show();
              } else {
                $('#sopSOP_2').prop('checked',false);
                //$('#sopUseBoxInput').children().eq(0).hide();
                $('#sop_2UseBoxInput').hide();
              }
            }

            // Calculation method 항목이면 체크박스 선택 | If it's the Calculation method item, check the radio button
            if (pair.name == "Calculation method") {
                $('input[name="Calculation method"][value="' + pair.value + '"]').prop('checked', true);
            }

            // Client 항목이면 클라이언트 목록에 추가 | If it's the Client item, add to the client list
            if (pair.name == "Client") {
                var loadClientArr = [];
                $('#clientSelect option').each(function(){
                    if ($(this).val() !== '') {
                        loadClientArr.push($(this).val());
                    }
                });

                // 클라이언트가 목록에 없으면 추가 | If the client is not in the list, add it
                if (!(loadClientArr.includes(pair.value))) {
                    var cliGrp = fillInputArray.find(o => o.name === 'Group').value;
                    var cliIdx = $('#clientSelect').find('optgroup[label="'+cliGrp+'"]');

                    cliIdx.append('<option value="'+pair.value+'">'+pair.value+'</option>');
                    $('#clientSelect').find(":selected").prop('selected', false);
                    cliIdx.find('option[value="'+pair.value+'"]').prop('selected', true);

                    $('#clientSelect').next().children().find('.filter-option-inner-inner').text($('#clientSelect').find(":selected").val());
                }
            }

            // 로드된 RFQ 이름 표시 | Show the loaded RFQ name
            $('.loaded-rfq-name').text(loadedRFQName);

            // 로드된 상태로 설정 | Set to loaded state
            isLoaded = true;

            // 업데이트 버튼 활성화 | Enable the update button
            $('#updateAll').removeClass('btn-disabled');
            $('#quoteForm').removeClass('was-validated');

            $('#updateAll').addClass("flash-update-btn");
            //$('#saveAll').addClass("flash-save-btn");
            if(rfqModeOS !== 'OS') {
                $('#saveAll').closest('.save-btn-group').addClass("flash-save-btn");
            } else {
                $('#save-exportAll').closest('.save-btn-group').addClass("flash-save-btn");
            }
        });

        // 이전에 선택된 값들 저장 | Save previously selected values
        previousS = $("#specialPanel").prop('selectedIndex');
        previousT = $("#trapQuestion").prop('selectedIndex');

        // Actual CPI 값 표시 | Display Actual CPI value
        $('.showActualCPI').text(AddComma(actualCPI));

        // $('.showSOP_1CPI').text(sop_1CPI);
        
        // $('.showSOP_2CPI').text(sop_2CPI);

        // 셀렉트피커 리프레시 | Refresh the selectpicker
        $('.selectpicker').selectpicker('refresh');

        // 파트너 사용 여부 확인 | Check if partners are used
        var noPartners = true;
        var partnerBoxCnt;
        $('#partnerUseBox').find('input').each(function(){
            if ($(this).val() !== "") {
                noPartners = false;

                // 파트너 사용 중이면 상자 표시 | If partners are in use, show the boxes
                if ($(this).attr('id').split('_')[1] == '1') {
                    partnerBoxCnt = 1;
                }
                if ($(this).attr('id').split('_')[1] == '2') {
                    partnerBoxCnt = 2;
                }
                if ($(this).attr('id').split('_')[1] == '3') {
                    partnerBoxCnt = 3;
                }
            }
        });

        // 파트너 사용 중이 아니면 스위치 해제 및 상자 숨김 | If no partners are in use, uncheck the switch and hide the boxes
        if (noPartners) {
            $('#partnerUseSwitch').prop('checked', false);
            $('#partnerUseBox').children().hide();
            $('#partnerUseBoxCnt').prop('selectedIndex', 0);
            $('#partnerUseBoxCnt').parent().hide();
            $('#partnerUseBox').removeClass('partnerusebox-bottom-margin');
        } else {
            // 파트너 사용 중이면 스위치 설정 및 상자 표시 | If partners are in use, set the switch and show the boxes
            $('#partnerUseSwitch').prop('checked', true);
            $('#partnerUseBoxCnt').parent().show();
            $('#partnerUseBoxCnt').prop('selectedIndex', partnerBoxCnt - 1);
            $('#partnerUseBox').addClass('partnerusebox-bottom-margin');

            // 파트너 상자 수에 따라 상자 표시 여부 설정 | Show or hide boxes based on the number of partner boxes
            if (partnerBoxCnt == 1) {
                $('#partnerUseBox').children().eq(0).show();
                $('#partnerUseBox').children().eq(1).hide();
                $('#partnerUseBox').children().eq(2).hide();
            }
            if (partnerBoxCnt == 2) {
                $('#partnerUseBox').children().eq(0).show();
                $('#partnerUseBox').children().eq(1).show();
                $('#partnerUseBox').children().eq(2).hide();
            }
            if (partnerBoxCnt == 3) {
                $('#partnerUseBox').children().eq(0).show();
                $('#partnerUseBox').children().eq(1).show();
                $('#partnerUseBox').children().eq(2).show();
            }
        }

        var noSOP = true;

        $('#sopUseBoxInput').find("input[name$='Costs']").each(function(){
          if($(this).val() !== '') {
            noSOP = false;
          }
        })

        if(noSOP) {
          $('#sopUseSwitch').prop('checked', false);
          $('#sopUseBox').hide();
        } else {
          $('#sopUseSwitch').prop('checked', true);
          $('#sopUseBox').show();
        }

        // RFQ 목록 드롭다운 선택 초기화 | Refresh the RFQ list selection picker
        $('#selectRFQList').selectpicker('refresh');

        // Load RFQ Data 모달 숨김 | Hide the Load RFQ Data modal
        $('#loadRFQDataModal').modal('hide');
    });

    // Load RFQ Data 모달이 닫혔을 때 | When Load RFQ Data modal is closed
    $(document).on('hidden.bs.modal', '#loadRFQDataModal', function () {
      // fillInputArray 초기화 | Reset fillInputArray
      fillInputArray = [];
    });

    // Dropdown 항목에 mouseover 했을 때 툴팁 보여주기 | Show tooltips when hovering over items in the dropdown list
    // function appendTooltips($el) {
    //   var $lis = $el.data('selectpicker').selectpicker.main.elements; // 선택된 옵션 요소 가져오기 | Get selected option elements

    //   $($lis).each(function (i) {
          
    //       // 옵션에서 제목 가져오기 | Get the title from the option
    //       var tooltip_title = $el.find('option').eq(i+1).attr('title');
          
    //       $(this).tooltip({
    //         title: tooltip_title || '', // 툴팁 제목 설정 또는 빈 문자열 | Set tooltip title or an empty string
    //         boundary: 'viewport',
    //         placement: 'top',
    //         trigger: 'hover'
    //       }).on('click mousedown mouseup', function () {
    //           $(this).tooltip('hide');
    //       }); 
          
    //   });
    // }
    
    
    // RFQ 목록 리스트 드롭다운이 refresh 될 때 | When RFQ select list dropdown is refreshed
    // $('#selectRFQList').selectpicker().on('refreshed.bs.select', function(e) {
    //   appendTooltips($(this));
    // });

    // 캘린더 형식으로 날짜 선택 가능하도록 (daterangepicker 플러그인 사용) |  Allow date selection in a calendar format (using daterangepicker plugin)
    // $('[id^=dateSelect]').daterangepicker({
    //     "singleDatePicker": true,
    //     "startDate": endDate,
    //     "maxDate": endDate,
    //     "locale": {
    //       "format": "M/D/YYYY"
    //     }
    // });

    // $('#dateSelectOS').on('hide.daterangepicker', function() {
    //   $(this).focus();
    // });

    // 헤더 부분의 [save] 버튼 클릭 시 | When [save] button in the header is clicked
    $(document).on('click', '#saveAll', function (e) {
      e.preventDefault(); // 이벤트 기본 동작 중단 | Prevent default event behavior
      //$(this).removeClass("flash-save-btn"); // flash 버튼 클래스 제거 | Remove flash button class
      if(rfqModeOS !== 'OS') {
        $(this).closest('.save-btn-group').removeClass("flash-save-btn");
      } else {
        $('#save-exportAll').closest('.save-btn-group').removeClass("flash-save-btn");
      }
      $('#formType').val('save'); // 폼 유형 'save'로 설정 | Set form type to 'save'
      ValidateForm(); // 폼 유효성 검사 | Validate form
    });

    // 헤더 부분의 [update] 버튼 클릭 시 | When [update] button in the header is clicked
    $(document).on('click', '#saveDraft', function (e) {
      e.preventDefault(); // 이벤트 기본 동작 중단 | Prevent default event behavior
      $(this).removeClass("flash-update-btn");
      //if (isLoaded == true) { // RFQ가 로드 되어있으면 | If RFQ is loaded
          $('#formType').val('save-draft'); // 폼 유형 'update'로 설정 | Set form type to 'update'
          ValidateForm(); // 폼 유효성 검사 | Validate form
    //   } else { // RFQ가 로드 되어있지 않으면 경고창 표시 | If RFQ is not loaded, show warning popup
    //       if (lang == "ko" || lang == "") {
    //           $('#alertMessage').text('[Load] 버튼을 클릭 후, RFQ를 선택해주세요.');
    //       }
    //       if (lang == "en") {
    //           $('#alertMessage').text('Please select RFQ first by clicking the [Load] button.');
    //       }

    //       $modal = $('#warningAlert');
    //       $modal.modal('show'); // 경고 모달 표시 | Show warning modal
    //   }
    });

    // 헤더 부분의 [update] 버튼 클릭 시 | When [update] button in the header is clicked
    $(document).on('click', '#updateAll', function (e) {
      e.preventDefault(); // 이벤트 기본 동작 중단 | Prevent default event behavior
      $(this).removeClass("flash-update-btn");
      //if (isLoaded == true) { // RFQ가 로드 되어있으면 | If RFQ is loaded
          $('#formType').val('update'); // 폼 유형 'update'로 설정 | Set form type to 'update'
          ValidateForm(); // 폼 유효성 검사 | Validate form
    //   } else { // RFQ가 로드 되어있지 않으면 경고창 표시 | If RFQ is not loaded, show warning popup
    //       if (lang == "ko" || lang == "") {
    //           $('#alertMessage').text('[Load] 버튼을 클릭 후, RFQ를 선택해주세요.');
    //       }
    //       if (lang == "en") {
    //           $('#alertMessage').text('Please select RFQ first by clicking the [Load] button.');
    //       }

    //       $modal = $('#warningAlert');
    //       $modal.modal('show'); // 경고 모달 표시 | Show warning modal
    //   }
    });

    // Calculated quotation 부분의 [Calculate] 버튼 클릭 시 | When [Calculate] button in the Calculated quotation section is clicked
    $(document).on('click', '#calcAll', function (e) {
        // 기본 이벤트 방지 | Prevent default event
        e.preventDefault();

        // 입력값 가져오기 | Get input values
        var input_loi = $('#loiInput').val();
        var input_ir = $('#irInput').val();
        var cpiValue = $('#cpiValue').val();
        var sampleNum = $('#sampleNum').val();
        var possibleNum = $('#possibleNum').val();
        var compPt = $('#compPt').val();

        // 아래 입력값이 비어 있으면 경고창 표시 | If input values below are empty, show warning popup
        if (input_ir == "" || input_loi == "" || cpiValue == "" || sampleNum == "" || possibleNum == "" || compPt == "") {
            // 언어에 따라 메시지 설정 | Set message based on language
            if (lang == "ko" || lang == "") {
                $('#alertMessage').text('IR, LOI, CPI, 요청 샘플수, dS 가능수, 완료 포인트 항목을 입력해주세요.');
            }
            if (lang == "en") {
                $('#alertMessage').text('Please enter IR, LOI, CPI, Requested N, dS Feasible N, Complete points to calculate.');
            }

            // 경고 모달 표시 | Show warning modal
            $modal = $('#warningAlert');
            $modal.modal('show');
            return false;
        }

        // 숨겨진 필드 채우기 | Fill hidden fields
        FillHidden();

        // 테이블에 계산 결과 행 추가 | Append calculated result row to the table
        AppendCalculatedResult();
    });
    
    // Quote table 부분의 [Generate] 버튼 클릭 시 | When [Generate] button in the Quote table section is clicked
    $(document).on('click', '#generateTable', function (e) {
        // 기본 이벤트 방지 | Prevent default event
        e.preventDefault();

        // 입력값 가져오기 | Get input values
        var cpiValue = $('#cpiValue').val();
        var sampleNum = $('#sampleNum').val();

        // 아래 입력값이 비어 있으면 경고창 표시 | If input values below are empty, show warning popup
        if (cpiValue == "" || sampleNum == "") {
            // 언어에 따라 메시지 설정 | Set message based on language
            if (lang == "ko" || lang == "") {
                $('#alertMessage').text('CPI, 요청 샘플수 항목을 입력해주세요.');
            }
            if (lang == "en") {
                $('#alertMessage').text('Please enter CPI and Requested N to generate.');
            }

            // 경고 모달 표시 | Show warning modal
            $modal = $('#warningAlert');
            $modal.modal('show');
            return false;
        }

        // 숨겨진 필드 채우기 | Fill hidden fields
        FillHidden();

        // 테이블에 계산 결과 표시 | Show calculated result in the table
        FillQuoteTable();
    });

    $(document).on('change', '[id^=updateStatusSwitch]', function () {
        // 만약 'otherFeeSwitch'가 선택되었을 경우 | If 'otherFeeSwitch' is checked
        if ($(this).is(':checked')) {
            // '운영비 항목'를 보여줌 | Show 'Other fee options'
            $(this).closest('div.row').parent().find('[id^=rfqStatusBox]').show();
        } else {
            // 그렇지 않으면 '운영비 항목'를 숨김 | Otherwise, hide 'Other fee options'
            //$('.rfq-status').hide();
            $(this).closest('div.row').parent().find('[id^=rfqStatusBox]').hide();
        }
    });

    

    // 'otherFeeSwitch'의 변경 이벤트에 대한 핸들러 등록 | Register a handler for the change event of 'otherFeeSwitch'
    $(document).on('change', '[id^=otherFeeSwitch]', function () {
        var $otherFeeBoxEl = $(this).closest('div.row').parent().find('[id^=otherFeeBox]');

        // 만약 'otherFeeSwitch'가 선택되었을 경우 | If 'otherFeeSwitch' is checked
        if ($(this).is(':checked')) {
            // '운영비 항목'를 보여줌 | Show 'Other fee options'
            $otherFeeBoxEl.show();
        } else {
            // 그렇지 않으면 '운영비 항목'를 숨김 | Otherwise, hide 'Other fee options'
            //$('#otherFeeBox').hide();
            $otherFeeBoxEl.hide();

            var otherFeeSubtract = 0;
            var $operationCostEl = $(this).closest('div.row').parent().find('[id^=operationCost]');
            var otherFee = $operationCostEl.val() === "" ? 0 : parseInt($operationCostEl.val().replace(/,/g , ''),10);
            $otherFeeBoxEl.find('.checkbox-option').each(function(index){
              FlashBorder('#' + $operationCostEl.attr('id'));
              if($(this).is(':checked')) {
                otherFeeSubtract = otherFeeSubtract + otherFeeArray[index];
              } 
            });
            $operationCostEl.val(otherFee - otherFeeSubtract == 0 ? '' : AddComma(otherFee - otherFeeSubtract));

            $otherFeeBoxEl.find('.checkbox-option').prop('checked',false);
        }
    });

    // 'partnerUseSwitch'의 변경 이벤트에 대한 핸들러 등록 | Register a handler for the change event of 'partnerUseSwitch'
    $(document).on('change', '[id^=partnerUseSwitch]', function () {
        // 만약 'partnerUseSwitch'가 선택되었을 경우 | If 'partnerUseSwitch' is checked
        if ($('#partnerUseSwitch').is(':checked')) {
            // 'partnerUseBoxCnt'의 부모를 보여줌 | Show the parent of 'partnerUseBoxCnt'
            $('#partnerUseBoxCnt').parent().show();
            
            // 'partnerUseBox'의 첫 번째 자식을 보여줌 | Show the first child of 'partnerUseBox'
            $('#partnerUseBox').children().eq(0).show();

            $('#partnerUseBox').addClass('partnerusebox-bottom-margin');
            
            // 파트너 비용 계산 함수 호출 | Call the CalculatePartnerCost() function
            CalculatePartnerCost();
        } else {
            // 그렇지 않으면 'partnerUseBoxCnt'의 부모를 숨김 | Otherwise, hide the parent of 'partnerUseBoxCnt'
            $('#partnerUseBoxCnt').parent().hide();
            
            // 'partnerUseBox'의 모든 자식을 숨김 | Hide all children of 'partnerUseBox'
            $('#partnerUseBox').children().hide();
            
            // 'partnerUseBoxCnt'의 값 1로 설정 | Set the value of 'partnerUseBoxCnt' to 1
            $('#partnerUseBoxCnt option[value=1]').prop('selected', true);

            $('#partnerUseBox').removeClass('partnerusebox-bottom-margin');
            
            // 'partnerUseBox'의 모든 자식의 입력값을 비움 | Empty the input values of all children of 'partnerUseBox'
            $('#partnerUseBox').children().find('input').val('');
        }
    });

    // 'partnerUseBoxCnt'의 변경 이벤트에 대한 핸들러 등록 | Register a handler for the change event of 'partnerUseBoxCnt'
    $(document).on('change', '#partnerUseBoxCnt', function () {
        // 선택된 값에 따라 조건 분기 | Conditional branching based on the selected value
        if ($(this).find(':selected').val() == 1) {
            // 선택된 값이 1이면 첫 번째 자식을 보여주고 나머지는 숨김 | If the selected value is 1, show the first child and hide the rest
            $('#partnerUseBox').children().eq(0).show();
            $('#partnerUseBox').children().eq(1).hide();
            $('#partnerUseBox').children().eq(2).hide();
        }
        if ($(this).find(':selected').val() == 2) {
            // 선택된 값이 2이면 첫 번째와 두 번째 자식을 보여주고 나머지는 숨김 | If the selected value is 2, show the first and second children and hide the rest
            $('#partnerUseBox').children().eq(0).show();
            $('#partnerUseBox').children().eq(1).show();
            $('#partnerUseBox').children().eq(2).hide();
        }
        if ($(this).find(':selected').val() == 3) {
            // 선택된 값이 3이면 모든 자식을 보여줌 | If the selected value is 3, show all children
            $('#partnerUseBox').children().eq(0).show();
            $('#partnerUseBox').children().eq(1).show();
            $('#partnerUseBox').children().eq(2).show();
        }
    });

    $(document).on('change', '[id^=sopUseSwitch]', function () {
        // 만약 'sopUseSwitch'가 선택되었을 경우 | If 'sopUseSwitch' is checked
        if ($('#sopUseSwitch').is(':checked')) {
            // 'sop 항목'를 보여줌 | Show 'sop options'
            $('#sopUseBox').show();
        } else {
            // 그렇지 않으면 'sop 항목'를 숨김 | Otherwise, hide 'sop options'
            $('#sopUseBox').hide();
            $('#sopUseBoxInput').children().hide();
            $('.sop-checkbox-option').prop('checked',false);
            $('#sopUseBoxInput').children().find('input').val('');
            //$('.showSOP_1CPI').text('');
            $('#sop_1CPI').val('');
            //$('.showSOP_2CPI').text('');
            $('#sop_2CPI').val('');
        }
    });
    
    $('.sop-checkbox-option').each(function(index){
      $(this).on('change', function(){
        if($(this).is(':checked')) {
          if ($(this).val() == 'SOP_1') {
            // 선택된 값이 1이면 첫 번째 자식을 보여주고 나머지는 숨김 | If the selected value is 1, show the first child and hide the rest
            $('#sopUseBoxInput').children().eq(0).show();
            CalculateSOP_1Cost();
          }
          if ($(this).val() == 'SOP_2') {
            // 선택된 값이 1이면 첫 번째 자식을 보여주고 나머지는 숨김 | If the selected value is 1, show the first child and hide the rest
            $('#sopUseBoxInput').children().eq(1).show();
            CalculateSOP_2Cost();
          }
          // if ($(this).val() == 'THEPOL') {
          //   // 선택된 값이 1이면 첫 번째 자식을 보여주고 나머지는 숨김 | If the selected value is 1, show the first child and hide the rest
          //   $('#sopUseBoxInput').children().eq(2).show();
          // }
        } else {
          if ($(this).val() == 'SOP_1') {
            // 선택된 값이 1이면 첫 번째 자식을 보여주고 나머지는 숨김 | If the selected value is 1, show the first child and hide the rest
            $('#sopUseBoxInput').children().eq(0).hide();
            $('#sopUseBoxInput').children().eq(0).find('input').val('');
            //$('.showSOP_1CPI').text('');
            $('#sop_1CPI').val('');
          }
          if ($(this).val() == 'SOP_2') {
            // 선택된 값이 1이면 첫 번째 자식을 보여주고 나머지는 숨김 | If the selected value is 1, show the first child and hide the rest
            $('#sopUseBoxInput').children().eq(1).hide();
            $('#sopUseBoxInput').children().eq(1).find('input').val('');
            //$('.showSOP_2CPI').text('');
            $('#sop_2CPI').val('');
          }
          // if ($(this).val() == 'THEPOL') {
          //   // 선택된 값이 1이면 첫 번째 자식을 보여주고 나머지는 숨김 | If the selected value is 1, show the first child and hide the rest
          //   $('#sopUseBoxInput').children().eq(2).hide();
          //   $('#sopUseBoxInput').children().eq(2).find('input').val('');
          // }
        }
      });
    
    });

    // Quote table의 [copy] button에 툴팁 추가 | add tooltip to [copy] button in Quote table
    // $('#copy-button').tooltip();

    // // Quotation form의 '수주여부'에 툴팁 추가 | add tooltip to 'order status' in Quotation form
    // $('.order-status-label').tooltip();

    // $('[id^=refreshGmail]').tooltip();

    // $('#refreshCountryList').tooltip();

    // $('[data-toggle="tooltip"]').tooltip();

    // When the copy button is clicked, select the value of the text box, attempt
    // to execute the copy command, and trigger event to update tooltip message
    // to indicate whether the text was successfully copied.
    $('#copy-button').bind('click', function () {
        // 'quoteTable' 엘리먼트를 가져오기 | Get the 'quoteTable' element
        var urlField = document.getElementById('quoteTable_Container');

        // 새로운 레인지 및 선택 객체 생성 | Create a new Range and Selection object
        var range = document.createRange();
        var sel = window.getSelection();

        // 현재 선택된 범위 지우기 | Remove all currently selected ranges
        sel.removeAllRanges();

        // 'quoteTable'의 내용을 선택 범위로 설정 | Set the content of 'quoteTable' as the selection range
        range.selectNodeContents(urlField);
        sel.addRange(range);

        try {
            // 복사 명령 실행 | Execute the copy command
            var success = document.execCommand('copy');

            // 복사가 성공한 경우 | If copying is successful
            if (success) {
                // 'copy-button'에 'copied' 이벤트를 발생시켜 메시지 전달 | Trigger the 'copied' event on 'copy-button' to display a success message
                $('#copy-button').trigger('copied', ['Copied!']);
                
                // 현재 선택된 범위 지우기 | Remove all currently selected ranges
                sel.removeAllRanges();
            } else {
                // 복사가 실패한 경우 | If copying fails
                $('#copy-button').trigger('copied', ['Copy with Ctrl-c']);
            }
        } catch (err) {
            // 에러 발생 시 'copy-button'에 'copied' 이벤트를 발생시켜 에러 메시지 전달 | Trigger the 'copied' event on 'copy-button' to display an error message in case of an error
            $('#copy-button').trigger('copied', ['Copy with Ctrl-c']);
        }
    });

    // Handler for updating the tooltip message.
    $('#copy-button').bind('copied', function (event, message) {
        // 'copy-button'의 title 속성을 전달된 메시지로 설정 | Set the 'title' attribute of 'copy-button' to the provided message
        $(this).attr('title', message)
            // 툴팁 제목 수정 및 툴팁 표시 | Fix the tooltip title and show the tooltip
            .tooltip('_fixTitle')
            .tooltip('show')
            // 'copy-button'의 title 속성을 "Copy to Clipboard"으로 재설정 | Reset the 'title' attribute of 'copy-button' to "Copy to Clipboard"
            .attr('title', "Copy to Clipboard")
            // 툴팁 제목 수정 | Fix the tooltip title
            .tooltip('_fixTitle');
    });

    // Calculated quotation의 테이블 헤더에 툴팁 추가 | add tooltip to the table headers in Calcuated quotation section
    //$('.resultTableTooltip').tooltip(); 

    // 'input-number' 클래스를 가진 모든 엘리먼트에 대한 'input' 이벤트 핸들러 등록 | Register an 'input' event handler for all elements with the 'input-number' class
    // 숫자가 입력될 때, 세 자릿수 마다 쉼표를 추가 | Add comma to every third digit when number is entered 
    $(document).on('input', '.input-number', function () {
        if (!$(this).hasClass('allow-decimals')) {
            // Input is an integer-only field
            if (!isNaN(parseInt($(this).val().replace(/,/g, ''), 10))) {
                $(this).val(parseInt($(this).val().replace(/,/g, ''), 10).toLocaleString('en'));
            } else {
                $(this).val($(this).val().replace(/[^\d-]+/g, '')); // Allow only digits and a negative sign
            }
        }
    });

    // Logic for allowing decimals
    $(document).on('input', '.allow-decimals', function () {
        let inputValue = $(this).val();

        // Remove invalid characters (anything other than digits and a single dot)
        let sanitizedValue = inputValue.replace(/[^0-9.]/g, '');

        // Ensure there is only one decimal point
        let parts = sanitizedValue.split('.');
        if (parts.length > 2) {
            sanitizedValue = parts[0] + '.' + parts.slice(1).join('');
        }

        // Restrict to three decimal places if a decimal point exists
        if (parts.length === 2 && parts[1].length > 3) {
            sanitizedValue = parts[0] + '.' + parts[1].substring(0, 3);
        }

        // Format the number with commas for the integer part
        if (sanitizedValue) {
            let [integerPart, decimalPart] = sanitizedValue.split('.');
            integerPart = integerPart.replace(/^0+(?!$)/, ''); // Remove leading zeros
            integerPart = integerPart ? parseInt(integerPart, 10).toLocaleString('en') : '';
            $(this).val(decimalPart !== undefined ? `${integerPart}.${decimalPart}` : integerPart);
        } else {
            $(this).val('');
        }
    });

    $(document).on('click', '[id^=refreshGmail]', function(){
      $(this).find('.spinner').addClass('spinner-busy');
      $(this).find('.spinner+span').hide();
      //google.script.run.withFailureHandler(e => { GetFailAlert(e) }).withSuccessHandler(showGmailEmails).getGmailEmails();
      runWithRetry('getGmailEmails', showGmailEmails, GetFailAlert);
    });

  });

</script>